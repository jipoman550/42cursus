# philosopher

## 📌 프로젝트 목적

이 프로젝트의 주 목적은 **멀티태스킹 프로그래밍**의 기본 원리, 특히 **스레드(Threads)**와 **뮤텍스(Mutexes)** (필수 파트) 또는 **프로세스(Processes)**와 **세마포어(Semaphores)** (보너스 파트)를 이해하고 적용하는 것입니다.  
이를 통해 **공유 자원**에 대한 접근을 안전하게 관리하고, **데드락(Deadlock)** 및 **경쟁 상태(Race Condition)**와 같은 **동시성 문제**를 해결하는 방법을 학습하는 데 있습니다.

---

## 🧠 과제 개요

### 🍽️ 식사하는 철학자 문제 (Dining Philosophers Problem)

원탁에 앉은 **철학자들**과 그들 사이에 놓인 **포크**를 사용하여 식사, 수면, 생각을 반복하는 시뮬레이션을 구현합니다.  
철학자는 식사를 위해 **오른쪽**과 **왼쪽**의 포크 두 개를 모두 확보해야 합니다.  
시뮬레이션의 목표는 철학자가 **굶어 죽지 않도록** (`time_to_die` 시간 내에 식사를 시작하지 못하면 사망) **공정한 식사 분배**를 보장하는 것입니다.

### 💻 필수 및 보너스 파트

#### 🔹 필수 파트 (`philo`)
- **동시성 제어 메커니즘**: 뮤텍스 (`pthread_mutex_*`)
- **철학자 표현**: 스레드
- **포크 관리**: 각 포크는 뮤텍스로 보호

#### 🔹 보너스 파트 (`philo_bonus`)
- **동시성 제어 메커니즘**: 세마포어 (`sem_*`)
- **철학자 표현**: 프로세스 (`fork`, `kill`)
- **포크 관리**: 사용 가능한 포크 수를 세마포어로 중앙 관리


> ⚠️ **주의사항**: 보너스 파트는 **필수 파트가 완벽하게** 작동하는 경우에만 평가됩니다.

### ⚙️ 프로그램 인자 (Global rules)

프로그램은 다음 인자들을 받습니다:

1. `number_of_philosophers`: 철학자 수이자 포크 수.
2. `time_to_die` (ms): 마지막 식사 시작 또는 시뮬레이션 시작 후 이 시간 내에 식사하지 않으면 철학자 사망.
3. `time_to_eat` (ms): 철학자가 식사하는 데 걸리는 시간.
4. `time_to_sleep` (ms): 철학자가 잠자는 데 걸리는 시간.
5. `[number_of_times_each_philosopher_must_eat]` (선택): 모든 철학자가 이 횟수 이상 식사하면 시뮬레이션 종료. 생략 시 철학자가 사망할 때까지 진행.

---

## 🚀 구현 계획 및 진행 상황

### 1단계: 환경 설정 및 구조체 정의
- [ ] `t_philo` 구조체 정의 (철학자 정보)
- [ ] `t_data` 구조체 정의 (전체 시뮬레이션 정보 및 공유 자원)
- [ ] 철학자 수만큼 포크/뮤텍스 배열 할당
- [ ] 입력 인자 파싱 및 유효성 검사

### 2단계: 필수 파트 (`philo` - 스레드 & 뮤텍스)
- [ ] 각 철학자를 스레드로 생성
- [ ] 포크를 뮤텍스로 보호하고, 두 포크 획득 시 식사 시작
- [ ] 데드락 방지 로직 구현 (홀수/짝수 철학자 포크 집는 순서 차등 등)
- [ ] `gettimeofday`를 사용하여 밀리초 단위 시간 관리 및 로그 출력
- [ ] 철학자 사망 또는 최소 식사 횟수 충족 시 종료
- [ ] 공유 변수 접근 시 뮤텍스로 데이터 경쟁 방지

### 3단계: 보너스 파트 (`philo_bonus` - 프로세스 & 세마포어)
- [ ] 철학자를 프로세스로 생성 (`fork`)
- [ ] 포크를 세마포어(`sem_open`, `sem_wait`, `sem_post`)로 중앙 관리
- [ ] 로그 출력을 위한 세마포어 동기화 적용
- [ ] 메인 프로세스가 철학자 종료 감지 후 다른 프로세스 종료 (`kill`, `waitpid`)

### 4단계: 종료 및 리소스 정리
- [ ] 모든 뮤텍스/세마포어 해제
- [ ] 모든 스레드/프로세스 정상 종료 확인
- [ ] 메모리 누수 검사 (`valgrind` 등 사용)


| 단계 | 계획 | 상태 |
| :--- | :--- | :--- |
| **1단계** | 인자 파싱 및 데이터 구조 초기화 | ⏳ (WIP) |
| **2단계** | 시간 함수 및 로깅 함수 구현 | ⬜ (To Do) |
| **3단계** | **필수 파트** - 철학자 루틴 및 데드락 방지 | ⬜ (To Do) |
| **4단계** | **필수 파트** - 사망/종료 조건 모니터링 | ⬜ (To Do) |
| **5단계** | **보너스 파트** - 프로세스 & 세마포어 기반 구현 | ⬜ (To Do) |

---

## 🛠️ 디버깅 및 문제 해결 히스토리

| 날짜 | 파트 | 문제/버그 | 해결 방법 |
| :--- | :--- | :--- | :--- |
| YYYY-MM-DD | 필수 | **데드락 발생**: 모든 철학자가 왼쪽 포크만 집고 대기. | 비대칭 포크 집기 로직 적용 |
| YYYY-MM-DD | 필수 | **경쟁 상태**: 로그 메시지가 겹침. | 로깅 전용 뮤텍스/세마포어 사용 |
| YYYY-MM-DD | 필수 | **시간 오차**: 사망 메시지 지연 출력. | 더 빈번한 체크 또는 모니터 스레드 사용 |

---

## 📂 디렉토리 구조

```

.
├── philo/
│   ├── src/
│   │   ├── main.c
│   │   ├── philo.c
│   │   ├── init.c
│   │   └── utils.c
│   ├── inc/
│   │   └── philo.h
│   └── Makefile
├── philo_bonus/ (선택 사항)
│   ├── src/
│   │   ├── main_bonus.c
│   │   ├── philo_bonus.c
│   │   └── ...
│   ├── inc/
│   │   └── philo_bonus.h
│   └── Makefile
└── README.md

````

---

## 빌드 및 실행

### 🏗️ 빌드 방법 (필수 파트: `philo`)
```bash
cd philo
make
````

### 🔨 빌드 방법 (보너스 파트: `philo_bonus`)

```bash
cd philo_bonus
make bonus
```

### 🚀 실행 예시

```bash
./philo number_of_philosophers time_to_die time_to_eat time_to_sleep [number_of_times_each_philosopher_must_eat]
```

예시:

```bash
./philo 5 100 50 50
./philo 4 410 200 200 5
```

---

## ✅ 최종 제출 점검표

| 검사 항목                                           | 필수 | 보너스 |
| :---------------------------------------------- | :- | :-- |
| C 언어로 작성됨                                       | ✅  | ✅   |
| Norm 준수 (Norminette 통과)                         | ✅  | ✅   |
| Makefile 규칙 (`all`, `clean`, `fclean`, `re`) 포함 | ✅  | ✅   |
| 전역 변수 사용 금지                                     | ✅  | ✅   |
| 메모리 누수 없음                                       | ✅  | ✅   |
| Data Race 없음                                    | ✅  | ✅   |
| 데드락 없음                                          | ✅  | ✅   |
| 모든 인자 처리 및 유효성 검사                               | ✅  | ✅   |
| 로그 형식 준수                                        | ✅  | ✅   |
| 사망 메시지 10ms 이내 출력                               | ✅  | ✅   |
| 프로세스/스레드 개수 정확                                  | ✅  | ✅   |
| 외부 함수 제한 준수                                     | ✅  | ✅   |

---

## 📝 메모

* **시간 단위**: 모든 인자는 밀리초(ms) 단위.
* **로그 동기화**: 출력은 반드시 동기화(뮤텍스/세마포어).
* **철학자 1명 케이스**: 포크를 집을 수 없어 사망해야 함.
* **자원 해제**: `pthread_mutex_destroy`, `sem_close`, `sem_unlink` 등을 반드시 호출.
